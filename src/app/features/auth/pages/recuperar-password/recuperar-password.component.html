<div class="recuperar-page">
  <header class="recuperar-header">
    <div class="logo-container">
      <img src="assets/logo-performia.png" alt="Performia">
      <span>Performia</span>
    </div>
    <button class="btn-home" routerLink="/auth/homepage">Ir a Página Principal</button>
  </header>

  <main class="recuperar-main">
    <div class="recuperar-left">
      <img src="assets/person-writing.png" alt="Profesional" />
    </div>

    <div class="recuperar-right">
      <!-- ==================== PASO 1: EMAIL ==================== -->
      <div class="recuperar-box" *ngIf="currentStep === 'email'">
        <div class="key-icon">
          <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
            <path d="M30 5C16.2 5 5 16.2 5 30C5 43.8 16.2 55 30 55C43.8 55 55 43.8 55 30C55 16.2 43.8 5 30 5Z" fill="#1E3A8A" opacity="0.1"/>
            <path d="M40 25C40 19.48 35.52 15 30 15C24.48 15 20 19.48 20 25C20 28.03 21.42 30.72 23.62 32.43L22.5 45H27.5L26.88 38H33.12L32.5 45H37.5L36.38 32.43C38.58 30.72 40 28.03 40 25Z" fill="#1E3A8A"/>
          </svg>
        </div>

        <h2>Recuperar<br>contraseña</h2>
        <p>Ingresa tu correo electrónico asociado a tu cuenta</p>

        <form (ngSubmit)="onSubmitEmail()" #emailForm="ngForm">
          <div class="form-group">
            <label>Correo Electrónico</label>
            <input
              type="email"
              [(ngModel)]="email"
              name="email"
              required
              email
              placeholder="correo@ejemplo.com"
            />
          </div>

          <button type="submit" [disabled]="emailForm.invalid || loading">
            <span *ngIf="!loading">Seguir</span>
            <span *ngIf="loading" class="spinner"></span>
          </button>
        </form>
      </div>

      <!-- ==================== PASO 3: NUEVA CONTRASEÑA ==================== -->
      <div class="recuperar-box" *ngIf="currentStep === 'password'">
        <div class="key-icon">
          <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
            <circle cx="30" cy="30" r="25" fill="#059669" opacity="0.1"/>
            <path d="M30 15C21.72 15 15 21.72 15 30C15 38.28 21.72 45 30 45C38.28 45 45 38.28 45 30C45 21.72 38.28 15 30 15ZM27 36L18 27L20.41 24.59L27 31.17L39.59 18.58L42 21L27 36Z" fill="#059669"/>
          </svg>
        </div>

        <h2>Nueva<br>contraseña</h2>
        <p>Ingresa tu nueva contraseña</p>

        <div class="alert alert-error" *ngIf="mensaje">
          {{ mensaje }}
        </div>

        <form (ngSubmit)="onSubmitPassword()" #passwordForm="ngForm">
          <div class="form-group">
            <label>Nueva Contraseña</label>
            <div class="password-input-wrapper">
              <input
                [type]="showPassword ? 'text' : 'password'"
                [(ngModel)]="newPassword"
                name="newPassword"
                required
                minlength="8"
                placeholder="Mínimo 8 caracteres"
              />
              <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
                <svg *ngIf="!showPassword" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"/>
                  <path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
                <svg *ngIf="showPassword" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
                  <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Confirmar Contraseña</label>
            <div class="password-input-wrapper">
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                [(ngModel)]="confirmPassword"
                name="confirmPassword"
                required
                minlength="8"
                placeholder="Repite tu contraseña"
              />
              <button type="button" class="toggle-password" (click)="toggleConfirmPasswordVisibility()">
                <svg *ngIf="!showConfirmPassword" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"/>
                  <path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
                <svg *ngIf="showConfirmPassword" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
                  <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="password-requirements">
            <p class="requirement" [class.met]="newPassword.length >= 8">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path fill-rule="evenodd" d="M8 16A8 8 0 108 0a8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L7 8.586 5.707 7.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              Mínimo 8 caracteres
            </p>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="goBack()">
              Volver
            </button>
            <button type="submit" class="btn-primary-submit" [disabled]="passwordForm.invalid || loading">
              <span *ngIf="!loading">Cambiar Contraseña</span>
              <span *ngIf="loading" class="spinner"></span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- ==================== MODAL: CÓDIGO ==================== -->
  <div class="modal" *ngIf="showModal && currentStep === 'code'" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-icon">
        <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
          <circle cx="30" cy="30" r="28" fill="#1E3A8A" opacity="0.1"/>
          <path d="M30 15C21.72 15 15 21.72 15 30C15 38.28 21.72 45 30 45C38.28 45 45 38.28 45 30C45 21.72 38.28 15 30 15ZM33 36H27V30H33V36ZM33 27H27V21H33V27Z" fill="#1E3A8A"/>
        </svg>
      </div>
      
      <h3>Código de verificación</h3>
      <p>Se le ha enviado un código de 6 dígitos a <strong>{{ email }}</strong></p>
      
      <div class="alert alert-error" *ngIf="mensaje">
        {{ mensaje }}
      </div>

      <div class="code-inputs" (paste)="onCodePaste($event)">
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          (keydown)="onCodeKeyDown(0, $event)"
          autocomplete="off"
        />
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          (keydown)="onCodeKeyDown(1, $event)"
          autocomplete="off"
        />
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          (keydown)="onCodeKeyDown(2, $event)"
          autocomplete="off"
        />
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          (keydown)="onCodeKeyDown(3, $event)"
          autocomplete="off"
        />
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          (keydown)="onCodeKeyDown(4, $event)"
          autocomplete="off"
        />
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          (keydown)="onCodeKeyDown(5, $event)"
          autocomplete="off"
        />
      </div>

      <div class="modal-actions">
        <button class="btn-link" (click)="resendCode()" [disabled]="loading">
          ¿No recibiste el código? Reenviar
        </button>
        
        <button class="btn-modal" (click)="verifyCode()" [disabled]="codigo.length !== 6 || loading">
          <span *ngIf="!loading">Verificar</span>
          <span *ngIf="loading" class="spinner"></span>
        </button>
      </div>
    </div>
  </div>
</div>